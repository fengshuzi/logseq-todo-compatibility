# Logseq TODO 兼容插件 - 使用说明

## 快速开始

### 1. 安装依赖

```bash
cd logseq-todo-compatibility
npm install
```

### 2. 开发模式（推荐）

```bash
# 方式 1: npm 命令
npm run watch

# 方式 2: Shell 脚本（需要 fswatch）
./dev-watch.sh
```

这会自动：
- 监听代码变化
- 自动编译
- 自动部署到两个 vault

### 3. 在 Obsidian 中启用

1. 打开 Obsidian
2. 进入 Settings → Community Plugins
3. 关闭 Safe Mode
4. 点击 "Reload plugins"
5. 找到 "Logseq TODO Compatibility" 并启用

### 4. 测试

创建一个测试文件：

```markdown
TODO 这是一个待办事项
DOING 正在进行中
DONE 已完成
```

切换到阅读模式，应该看到复选框！

## 功能说明

### 支持的模式

✅ **阅读模式** - 在阅读模式下显示复选框  
✅ **实时预览模式** - 在编辑时也显示复选框（所见即所得）  
✅ **源码模式** - 保持原始 Logseq 格式

### 支持的状态

| 状态 | 显示 | 颜色 | 说明 |
|------|------|------|------|
| TODO | ☐ | 灰色 | 待办 |
| DOING | ☐ | 橙色 | 进行中 |
| LATER | ☐ | 蓝色 | 稍后 |
| NOW | ☐ | 红色 | 紧急 |
| DONE | ☑ | 绿色 | 完成 |
| CANCELED | ☑ | 灰色 | 取消 |

### 命令

打开命令面板 (Cmd/Ctrl + P)，搜索：

1. **Toggle Logseq TODO/DONE** - 在 TODO 和 DONE 之间切换
2. **Insert Logseq TODO** - 插入 TODO
3. **Insert Logseq TODO task** - 插入 TODO 任务（可替代 Cmd+Enter）
4. **Cycle Logseq TODO status** - 循环切换所有状态

### 快捷键

#### 使用 TODO 替代复选框（推荐）

插件提供了 "Insert Logseq TODO task" 命令，默认绑定到 `Cmd+Enter`（Mac）或 `Ctrl+Enter`（Windows/Linux）。

**设置方法：**

1. 打开 Settings → Hotkeys
2. 搜索 "Insert Logseq TODO task"
3. 设置为 `Cmd+Enter`（如果已被占用，先删除原有绑定）
4. 或者在插件设置中启用 "Use TODO instead of checkbox for Cmd+Enter"

**效果：**
- 按 `Cmd+Enter` 会插入 `- TODO ` 而不是 `- [ ]`
- 保持列表缩进和格式
- 自动定位光标到合适位置

### 设置

在插件设置中可以：
- 启用/禁用阅读模式渲染
- 启用/禁用实时预览模式渲染（所见即所得）
- 显示/隐藏状态标签
- 自定义每个状态的颜色
- **使用 TODO 替代 Cmd+Enter 的复选框**（新功能）

**注意**: 修改实时预览模式设置或 Cmd+Enter 行为后需要重新加载 Obsidian。

## 开发命令

```bash
# 开发模式（自动监听并部署）
npm run watch

# 一次性构建并部署
npm run deploy

# 仅构建（不部署）
npm run build

# 仅开发编译（不部署）
npm run dev
```

## 部署目录

插件会自动部署到：

1. **Pro Vault**: 
   ```
   ~/Library/Mobile Documents/iCloud~md~obsidian/Documents/漂泊者及其影子/.obsidian-pro/plugins/logseq-todo-compatibility
   ```

2. **Mobile Vault**: 
   ```
   ~/Library/Mobile Documents/iCloud~md~obsidian/Documents/漂泊者及其影子/.obsidian-mobile/plugins/logseq-todo-compatibility
   ```

## 常见问题

### Q: 复选框没有显示？

A: 确保：
1. 在阅读模式（不是编辑模式）
2. 插件已启用
3. 设置中启用了 "Enable reading mode rendering"
4. 语法正确（状态后面要有空格）

### Q: 点击复选框没反应？

A: 检查：
1. 文件是否可写
2. 浏览器控制台是否有错误
3. 尝试重新加载插件

### Q: 如何重新加载插件？

A: 
1. 打开命令面板 (Cmd/Ctrl + P)
2. 搜索 "Reload app without saving"
3. 或者禁用再启用插件

### Q: 修改代码后看不到效果？

A: 
1. 确保使用了 `npm run watch` 或 `./dev-watch.sh`
2. 检查控制台是否有编译错误
3. 在 Obsidian 中重新加载插件

## 文件结构

```
logseq-todo-compatibility/
├── main.ts              # 插件主文件
├── settings.ts          # 设置面板
├── styles.css           # 样式文件
├── manifest.json        # 插件元数据
├── package.json         # npm 配置
├── deploy.mjs           # 部署脚本
├── watch-deploy.mjs     # 监听部署脚本
├── build-to-vaults.sh   # Shell 构建脚本
├── dev-watch.sh         # Shell 开发脚本
└── README.md            # 文档
```

## 开发流程

1. **修改代码** → 保存文件
2. **自动编译** → esbuild 自动编译
3. **自动部署** → 复制到 vault
4. **重新加载** → 在 Obsidian 中重新加载插件
5. **测试** → 验证功能

## 调试技巧

### 查看日志

1. 打开 Obsidian 开发者工具：Cmd/Ctrl + Shift + I
2. 查看 Console 标签
3. 插件会输出调试信息

### 添加日志

在代码中添加：

```typescript
console.log('调试信息', variable);
```

### 检查文件是否部署

```bash
ls -la "/Users/lizhifeng/Library/Mobile Documents/iCloud~md~obsidian/Documents/漂泊者及其影子/.obsidian-pro/plugins/logseq-todo-compatibility/"
```

## 下一步

- 查看 `EXAMPLE.md` 了解更多用法示例
- 查看 `DEPLOY.md` 了解详细的部署选项
- 查看 `QUICK_START.md` 了解完整的开发指南

## 反馈

如果遇到问题或有建议，欢迎：
- 提交 Issue
- 提交 Pull Request
- 联系开发者

---

**祝你使用愉快！** 🎉
